<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width" charset="UTF-8">
  <title>SolSpec LiDAR offerings</title>
  <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>
  <script src="vendor/leaflet.groupedlayercontrol.js"></script>
  <link rel="stylesheet" src="/app.css"></link>
  <!--[if IE]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style>
    body {
      padding:0;
      margin:0;
    }
    h2{
      display:inline
    }
    #map {
      width: 100%;
      height: 100vh;
      float: left;
      position: relative;
    }
    #mapTitle{
      text-align: center;
    }
    #logo{
      width: 150px;
    }
    .leaflet-left .leaflet-control{
      margin: 0;
      height: 100vh;
    }
    .leaflet-control-layers{
      width: 25vw;
    }
    .leaflet-control-layers-group-name {
      font-size: 25px;
      font-weight: bold;
    }
</style>
</head>
<body>
  <div id="map"></div>
  <script>
    function init() {
      var centerline = $.ajax({
       url:"https://api.solspec.solutions/public/tiler/file?key=HG_Energy/centerline_.geojson",
       dataType: "json",
       success: console.log("Centerline successfully loaded!"),
       error: function (xhr) {
          alert(xhr.statusText)
        }
      }),
      hydro = $.ajax({
       url:"https://api.solspec.solutions/public/tiler/file?key=HG_Energy/problematic_surface_hydrology.geojson",
       dataType: "json",
       success: console.log("Hydro successfully loaded!"),
       error: function (xhr) {
          alert(xhr.statusText)
          }
      }),
      landslides = $.ajax({
         url:"https://api.solspec.solutions/public/tiler/file?key=HG_Energy/active_landslides_.geojson",
         dataType: "json",
         success: console.log("Data successfully loaded!"),
         error: function (xhr) {
          alert(xhr.statusText)
         }
      });

    $.when(landslides).done(function() {
        function activeLandslideStyle(feature) {
          return {
            fillColor: 'red',
            weight: 2,
            opacity: 1,
            color: 'red',  //Outline color
            fillOpacity: 0.5
          };
        }
        function centerlineStyle(feature) {
          return {
            weight: 2,
            color: 'yellow',  //Outline color
            fillOpacity: 0.5
          };
        }
        var baselayers = {
            "<h2>Digital Surface Model (DSM)</h2><p>First thing that the lidar bounces off of; treetops, cars, houses</p>": L.tileLayer('https://api.solspec.solutions/public/tiler/tiles/{z}/{x}/{y}.png?key=HG_Energy/dtm_cog.tif&processing=hillshade'),
            "<h2>Digital Terrain Model (DTM)</h2><p>Best guess at bare earth terrain</p>": L.tileLayer('https://api.solspec.solutions/public/tiler/tiles/{z}/{x}/{y}.png?key=HG_Energy/dtm_cog.tif'),
            "<h2>Hillshade</h2><p></p>": L.tileLayer('https://api.solspec.solutions/public/tiler/tiles/{z}/{x}/{y}.png?key=HG_Energy/dsm_cog.tif&style=hypso.txt'),
        },
        overlays = {
          "Reference Layers": {
        		"Centerline": L.geoJson(centerline.responseJSON, {style: centerlineStyle}),
            "Active Landslides":  L.geoJson(landslides.responseJSON, {style: activeLandslideStyle})
          }
          // "Analytics": {
          //   "Hillshade with trees":L.tileLayer('https://api.solspec.solutions/public/tiler/tiles/{z}/{x}/{y}.png?key=HG_Energy/dtm_cog.tif&processing=hillshade'),
          //   "Potential Landslides": L.tileLayer('https://api.solspec.solutions/public/tiler/tiles/{z}/{x}/{y}.png?key=HG_Energy/landslide_potential/landslide_potential_enhanced_cog.tif'),
          //   "Surface Hydrology Channels":L.tileLayer('https://api.solspec.solutions/public/tiler/tiles/{z}/{x}/{y}.png?key=HG_Energy/d_infinity/d_infinity_cog.tif&style=BrownPurple-v2.txt'),
          //   "Hydro": L.geoJson(hydro.responseJSON),
          // },
      	},
        southWest = L.latLng(39.11485269995679, -80.54695028811695),
        northEast = L.latLng(39.136659043917334, -80.47309298068286),
        bounds = L.latLngBounds(southWest, northEast);
        // initialize map object with view
        window.map = L.map('map',{
          center: [39.12326041218261, -80.50060372799635],
          zoomControl: false,
          maxBounds: bounds,
          zoom: 16,
          maxZoom: 22,
          minZoom: 15,
          layers: [overlays["Reference Layers"]["Centerline"], overlays["Reference Layers"]["Active Landslides"]]
        });
        L.control.zoom({position:'topright'}).addTo(window.map);
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw',{id: 'mapbox.satellite'}).addTo(map);

        L.control.groupedLayers(baselayers, overlays,  { position: 'topleft', collapsed: false}).addTo(window.map);
        $('<h6 id="mapTitle"><img src="logo.png" id="logo" alt="solspec logo"></h6>').insertBefore('div.leaflet-control-layers-base');
        window.map.on('moveend', function() {
          console.log(window.map.getBounds());
          console.log(window.map.getCenter())
        });
    });
    };
    window.onload = init();
  </script>
</body>
</html>
